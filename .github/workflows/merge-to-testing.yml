name: Merge main into testing/Live
run-name: ${{ github.actor }} is merging ${{ github.ref }} into ${{ inputs.targetBranch }} üöÄ
on: 
  workflow_dispatch:
    inputs:
      targetBranch:
        description: 'Target Branch'
        required: true
        default: 'testing'
        type: choice
        options:
        - testing
        - live
      force:
        description: 'Force sync (hard reset to main)'
        required: true
        default: false
        type: boolean
jobs:
  manual_merge:
    if: github.event_name == 'workflow_dispatch' || github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Attempt the merge
        run: |
          git checkout ${{ inputs.targetBranch }}
          git merge main --ff-only
          git push
      - name: Force merge if necessary
        if: ${{ failure() && inputs.force == 'true' }}
        run: |
          git checkout ${{ inputs.targetBranch }}
          git reset --hard main
          git push --force  
      - run: echo "üçè This job's status is ${{ job.status }}."
